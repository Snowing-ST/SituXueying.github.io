I"ÿ1<p>ä½¿ç”¨æ–‡æœ¬èšç±»çš„æ–¹å¼æå–æ¯æ¡å®ä¹ ä¿¡æ¯ä¸­æè¿°ä¸“ä¸šæŠ€èƒ½çš„å¥å­</p>

<h1 id="åŸºäºæ–‡æœ¬èšç±»çš„æ‹›è˜ä¿¡æ¯ä¸­æŠ€èƒ½è¦æ±‚æå–ä¸é‡åŒ–">ã€ŠåŸºäºæ–‡æœ¬èšç±»çš„æ‹›è˜ä¿¡æ¯ä¸­æŠ€èƒ½è¦æ±‚æå–ä¸é‡åŒ–ã€‹</h1>

<ul>
  <li>ä¸Šç¯‡ <a href="Extracting-Skill-Imformation-from-recruitment-ADs-with-text-clustering-1.html">å®ä¹ åƒ§çˆ¬è™«ä¸æ‹›è˜ä¿¡æ¯æ–‡æœ¬é¢„å¤„ç†</a></li>
  <li>
    <font color="pink">ä¸­ç¯‡ æ‹›è˜ä¿¡æ¯æ–‡æœ¬èšç±»</font>
  </li>
  <li>ä¸‹ç¯‡ <a href="Extracting-Skill-Imformation-from-recruitment-ADs-with-text-clustering-3.html">é‡åŒ–è–ªèµ„ä¸æŠ€èƒ½çš„å…³ç³»</a></li>
</ul>

<h2 id="æ–‡æœ¬èšç±»">æ–‡æœ¬èšç±»</h2>
<p>æœ¬ç ”ç©¶ä¸­æ–‡æœ¬å‘é‡åŒ–é‡‡ç”¨tf-idfï¼Œç”¨ç¨€ç–æ–¹å¼å‚¨å­˜è¯-æ–‡æ¡£çŸ©é˜µã€‚çŸ©é˜µç»´åº¦ä¸ºt*nï¼Œtä»£è¡¨å¥å­ä¸ªæ•°ï¼Œnä»£è¡¨è¯è¯­ä¸ªæ•°ã€‚ æœ¬æ–‡é¢„å¤„ç†åçš„è¯æ±‡æœ‰1793ä¸ªï¼Œå¥å­2817æ¡ï¼Œæå–1000ä¸ªtf-idfç‰¹å¾ï¼Œå¾—åˆ° 2817*1000çš„æ–‡æ¡£è¯é¢‘çŸ©é˜µã€‚ä¸‹é¢å°†ç”¨ä¸‰ç§èšç±»æ–¹æ³•å¯¹â€œèŒä½æè¿°â€ä¸­çš„å¥å­è¿›è¡Œèšç±»ï¼Œæ ¹æ®èšç±»ç»“æœçš„è§£é‡Šæ€§é€‰æ‹©èšç±»æ•°ç›®ã€‚</p>

<h4 id="1kmeansèšç±»">1.Kmeansèšç±»</h4>

<p>Kmeansæ˜¯ä¸€ç§åŸºäºç›¸ä¼¼åº¦çš„èšç±»æ–¹æ³•ã€‚åœ¨èšç±»ä¹‹å‰ï¼Œéœ€è¦ç”¨æˆ·æ˜¾å¼åœ°å®šä¹‰ä¸€ä¸ªç›¸ä¼¼åº¦å‡½æ•°ã€‚èšç±»ç®—æ³•æ ¹æ®ç›¸ä¼¼åº¦çš„è®¡ç®—ç»“æœå°†ç›¸ä¼¼çš„æ–‡æœ¬åˆ†åœ¨åŒä¸€ä¸ªç»„ã€‚åœ¨è¿™ç§èšç±»æ¨¡å¼ä¸‹ï¼Œæ¯ä¸ªæ–‡æœ¬åªèƒ½å±äºä¸€ä¸ªç»„,è¿™ç§èšç±»æ–¹æ³•ä¹Ÿå«â€œç¡¬èšç±»â€ã€‚ K-Meansæ–¹æ³•æ˜¯MacQueen1967å¹´æå‡ºçš„ï¼ŒåŸç†æ˜¯ç»™å®šä¸€ä¸ªæ•°æ®é›†åˆXå’Œä¸€ä¸ªæ•´æ•°Kï¼ˆK&lt;nï¼‰ï¼ŒK-Meansæ–¹æ³•å°†Xåˆ†æˆKä¸ªèšç±»å¹¶ä½¿å¾—åœ¨æ¯ä¸ªèšç±»ä¸­æ‰€æœ‰å€¼ä¸è¯¥èšç±»ä¸­å¿ƒè·ç¦»çš„æ€»å’Œæœ€å°ã€‚</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#kmeans tfidf æ–‡æœ¬èšç±»---------------------------------------------------
</span><span class="kn">from</span> <span class="nn">sklearn.feature_extraction.text</span> <span class="kn">import</span> <span class="n">HashingVectorizer</span><span class="p">,</span><span class="n">TfidfVectorizer</span>
<span class="kn">from</span> <span class="nn">sklearn.cluster</span> <span class="kn">import</span> <span class="n">KMeans</span><span class="p">,</span><span class="n">MiniBatchKMeans</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="nn">time</span>



<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s">"/Users/situ/Documents/EDA/final"</span><span class="p">)</span>
<span class="c1">#os.chdir("E:/graduate/class/EDA/final")
</span>

<span class="k">def</span> <span class="nf">loadDataset</span><span class="p">(</span><span class="n">myfile</span><span class="p">):</span>
    <span class="s">'''å¯¼å…¥æ–‡æœ¬æ•°æ®é›†'''</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">myfile</span><span class="p">,</span><span class="s">'r'</span><span class="p">,</span><span class="n">encoding</span> <span class="o">=</span> <span class="s">"utf-8"</span><span class="p">)</span>
    <span class="n">dataset</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">():</span>
<span class="c1">#        print(line)
</span>        <span class="n">dataset</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">dataset</span>

<span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span><span class="n">n_features</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
    <span class="n">vectorizer</span> <span class="o">=</span> <span class="n">TfidfVectorizer</span><span class="p">(</span><span class="n">max_df</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">max_features</span><span class="o">=</span><span class="n">n_features</span><span class="p">,</span> <span class="n">min_df</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">use_idf</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">vectorizer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">X</span><span class="p">,</span><span class="n">vectorizer</span>

<span class="k">def</span> <span class="nf">knn_train</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">vectorizer</span><span class="p">,</span><span class="n">true_k</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">minibatch</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span><span class="n">showLable</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
    <span class="c1">#ä½¿ç”¨é‡‡æ ·æ•°æ®è¿˜æ˜¯åŸå§‹æ•°æ®è®­ç»ƒk-meansï¼Œ    
</span>    <span class="k">if</span> <span class="n">minibatch</span><span class="p">:</span><span class="c1">#æ•°æ®å¤šæ—¶ç”¨ï¼Œå¦‚å¤§äº1ä¸‡æ¡æ ·æœ¬
</span>        <span class="n">km</span> <span class="o">=</span> <span class="n">MiniBatchKMeans</span><span class="p">(</span><span class="n">n_clusters</span><span class="o">=</span><span class="n">true_k</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="s">'k-means++'</span><span class="p">,</span> <span class="n">n_init</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                             <span class="n">init_size</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">km</span> <span class="o">=</span> <span class="n">KMeans</span><span class="p">(</span><span class="n">n_clusters</span><span class="o">=</span><span class="n">true_k</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="s">'k-means++'</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">n_init</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                    <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">random_state</span><span class="o">=</span><span class="mi">1994</span><span class="p">)</span>
    <span class="n">km</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>    
    <span class="k">if</span> <span class="n">showLable</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Top terms per cluster:"</span><span class="p">)</span>
        <span class="n">order_centroids</span> <span class="o">=</span> <span class="n">km</span><span class="o">.</span><span class="n">cluster_centers_</span><span class="o">.</span><span class="n">argsort</span><span class="p">()[:,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">terms</span> <span class="o">=</span> <span class="n">vectorizer</span><span class="o">.</span><span class="n">get_feature_names</span><span class="p">()</span>
        <span class="k">print</span> <span class="p">(</span><span class="n">vectorizer</span><span class="o">.</span><span class="n">get_stop_words</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">true_k</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"Cluster </span><span class="si">%</span><span class="s">d:"</span> <span class="o">%</span> <span class="n">i</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s">''</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">order_centroids</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:</span><span class="mi">20</span><span class="p">]:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">' </span><span class="si">%</span><span class="s">s'</span> <span class="o">%</span> <span class="n">terms</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="n">end</span><span class="o">=</span><span class="s">''</span><span class="p">)</span>
            <span class="k">print</span><span class="p">()</span>
    <span class="n">result</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">km</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">))</span>
    <span class="k">print</span> <span class="p">(</span><span class="s">'Cluster distribution:'</span><span class="p">)</span>
    <span class="k">print</span> <span class="p">(</span><span class="nb">dict</span><span class="p">([(</span><span class="n">i</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">result</span><span class="p">]))</span>
    <span class="k">return</span> <span class="n">km</span>
    
<span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
    <span class="s">'''æµ‹è¯•é€‰æ‹©æœ€ä¼˜å‚æ•°'''</span>
    <span class="n">dataset</span> <span class="o">=</span> <span class="n">loadDataset</span><span class="p">(</span><span class="s">'clean_text.txt'</span><span class="p">)</span>    
    <span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="si">%</span><span class="s">d documents"</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataset</span><span class="p">))</span>
    <span class="n">X</span><span class="p">,</span><span class="n">vectorizer</span> <span class="o">=</span> <span class="n">transform</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span><span class="n">n_features</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
    <span class="n">true_ks</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">scores</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">1</span><span class="p">):</span>        
        <span class="n">score</span> <span class="o">=</span> <span class="o">-</span><span class="n">knn_train</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">vectorizer</span><span class="p">,</span><span class="n">true_k</span><span class="o">=</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
        <span class="k">print</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">score</span><span class="p">)</span>
        <span class="n">true_ks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">score</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">true_ks</span><span class="p">,</span><span class="n">scores</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s">"score"</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">"red"</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">"n_features"</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">"score"</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    
<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="s">'''åœ¨æœ€ä¼˜å‚æ•°ä¸‹è¾“å‡ºèšç±»ç»“æœ'''</span>
    <span class="n">dataset</span> <span class="o">=</span> <span class="n">loadDataset</span><span class="p">(</span><span class="s">'clean_text.txt'</span><span class="p">)</span>
    <span class="n">X</span><span class="p">,</span><span class="n">vectorizer</span> <span class="o">=</span> <span class="n">transform</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span><span class="n">n_features</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
    <span class="n">km</span> <span class="o">=</span> <span class="n">knn_train</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">vectorizer</span><span class="p">,</span><span class="n">true_k</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span><span class="n">showLable</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">score</span> <span class="o">=</span> <span class="o">-</span><span class="n">km</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
    <span class="k">print</span> <span class="p">(</span><span class="n">score</span><span class="p">)</span>
    <span class="n">test</span><span class="p">()</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>  

<span class="n">dataset</span> <span class="o">=</span> <span class="n">loadDataset</span><span class="p">(</span><span class="s">'clean_text.txt'</span><span class="p">)</span>
<span class="n">X</span><span class="p">,</span><span class="n">vectorizer</span> <span class="o">=</span> <span class="n">transform</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span><span class="n">n_features</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>    
<span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">km</span> <span class="o">=</span> <span class="n">knn_train</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">vectorizer</span><span class="p">,</span><span class="n">true_k</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span><span class="n">showLable</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>  
<span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="s">"time cost:"</span><span class="p">,</span><span class="n">end</span><span class="o">-</span><span class="n">start</span><span class="p">)</span>  
<span class="n">km</span><span class="o">.</span><span class="n">labels_</span><span class="c1">#ç¬¬5ç±»æ˜¯æŠ€èƒ½è¦æ±‚
</span>
<span class="c1">#å…³é”®è¯å’Œæƒé‡
</span><span class="n">order_centroids</span> <span class="o">=</span> <span class="n">km</span><span class="o">.</span><span class="n">cluster_centers_</span><span class="o">.</span><span class="n">argsort</span><span class="p">()[:,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">km</span><span class="o">.</span><span class="n">cluster_centers_</span><span class="p">)[:,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="c1">#argsort()å°†æ¯è¡Œæ•°ç»„çš„å€¼ä»å°åˆ°å¤§æ’åºåï¼Œå¹¶æŒ‰ç…§å…¶ç›¸å¯¹åº”çš„ç´¢å¼•å€¼è¾“å‡º.
#argsort()[:, ::-1] å°†æ¯è¡Œæ•°ç»„çš„å€¼ä»å¤§åˆ°å°æ’åºåï¼Œå¹¶æŒ‰ç…§å…¶ç›¸å¯¹åº”çš„ç´¢å¼•å€¼è¾“å‡º.
#np.sort(km.cluster_centers_)[:, ::-1] æŠŠæ¯è¡Œæ•°ç»„çš„å€¼ä»å¤§åˆ°å°æ’åº
</span><span class="n">terms</span> <span class="o">=</span> <span class="n">vectorizer</span><span class="o">.</span><span class="n">get_feature_names</span><span class="p">()</span> <span class="c1">#list
</span>
<span class="kn">import</span> <span class="nn">csv</span>
<span class="n">csvfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">"term_weight_km.csv"</span><span class="p">,</span><span class="s">'w'</span><span class="p">,</span><span class="n">newline</span><span class="o">=</span><span class="s">''</span><span class="p">,</span><span class="n">encoding</span><span class="o">=</span><span class="s">'utf-8-sig'</span><span class="p">)</span> 
<span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">csvfile</span><span class="p">)</span>
<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">km</span><span class="o">.</span><span class="n">cluster_centers_</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">500</span><span class="p">):</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="n">terms</span><span class="p">[</span><span class="n">order_centroids</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">]],</span><span class="n">weights</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">],</span><span class="n">j</span><span class="p">])</span>
<span class="n">csvfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></div>

<p>ç»è¿‡å¤šæ¬¡å°è¯•ä¸åŒçš„èšç±»ä¸ªæ•°ï¼Œå‘ç°æŠŠèšç±»ä¸ªæ•°å®šä¸º6ç±»æ—¶ï¼Œèƒ½å–å¾—è¾ƒå¥½çš„èšç±»æ•ˆæœï¼Œå³å„ä¸ªç±»åˆ«çš„æ–‡æœ¬èƒ½è¡¨è¾¾æ¸…æ™°æ˜ç¡®çš„å…±åŒå«ä¹‰ã€‚å›¾1ä¸­å…­ä¸ªè¯äº‘å›¾å±•ç¤ºäº†kmeansèšç±»çš„æ¯ä¸ªèšç±»ä¸­å¿ƒçš„å…³é”®è¯ï¼Œå…³é”®è¯å¤§å°ä¸kmeansè¾“å‡ºçš„æƒé‡å¤§å°æœ‰å…³ã€‚å¯ä»¥çœ‹åˆ°ï¼Œå‰æœ€ä¸Šæ–¹çš„ä¸¤å¼ è¯äº‘å›¾éƒ½æ˜¯æè¿°æ—¥å¸¸å·¥ä½œä»»åŠ¡ï¼Œæƒé‡å¤§çš„è¯æœ‰â€œæ•´ç†â€ã€â€œç ”ç©¶â€ã€â€œç›¸å…³â€ã€â€œç”¨æˆ·â€ã€â€œæ•°æ®å¤„ç†â€ï¼Œâ€œå®Œæˆâ€ã€â€œé¡¹ç›®â€ã€â€œæ•´ç†â€ã€â€œæ”¶é›†â€ã€‚ä¸­é—´å·¦å›¾ä¸­ï¼Œæƒé‡å¤§çš„è¯æœ‰â€œæ¥æ”¶â€ã€â€œæš‘æœŸå®ä¹ â€ã€â€œæ¯å‘¨â€ã€â€œå››å¤©â€ç­‰ï¼Œå¯ä»¥çœ‹å‡ºè¿™ä¸ªç±»åˆ«çš„å¥å­æ˜¯è·Ÿå®ä¹ æ—¶é—´æœ‰å…³ã€‚</p>

<p>ä¸­é—´å³å›¾ä¸­å‡ºç°äº†å¾ˆå¤šæ•°æ®åˆ†æå¸¸ç”¨çš„è½¯ä»¶ï¼Œå¦‚â€œpythonâ€ã€â€œexcelâ€ã€â€œsqlâ€ã€â€œspssâ€ã€â€œsasâ€ï¼Œè¯´æ˜è¿™ä¸ªç±»åˆ«çš„å¥å­æ˜¯æè¿°ä¸“ä¸šæŠ€èƒ½çš„ï¼Œä»ä¸­å¯ä»¥çœ‹å‡ºï¼Œofficeè½¯ä»¶ä»ç„¶æ˜¯æœ€ä¸ºåŸºç¡€çš„è¦æ±‚ï¼ŒåŒæ—¶ä¹Ÿè¦æ±‚åº”è˜è€…èƒ½ç†Ÿç»ƒæŒæ¡sqlè¯­è¨€ã€ä½¿ç”¨æ•°æ®åº“ï¼Œå½“pythonã€Rè½¯ä»¶ç­‰ç¼–ç¨‹è½¯ä»¶å…´èµ·æ—¶ï¼Œåƒsasã€spssç­‰ä¼ ç»Ÿçš„ç»Ÿè®¡åˆ†æè½¯ä»¶ä»ç„¶å æ®åŠå£æ±Ÿå±±ï¼Œå¦å¤–è¿˜æœ‰äº›æ•°æ®åˆ†æå®ä¹ è¦æ±‚æŒæ¡å¤§æ•°æ®ç›¸å…³çš„è½¯ä»¶å¦‚hadoopã€hiveç­‰ã€‚</p>

<p>æœ€ä¸‹æ–¹å·¦å›¾ä¸­æƒé‡å¤§è¯æœ‰â€œé€»è¾‘æ€ç»´â€ã€â€œæ²Ÿé€šâ€ã€â€œè´£ä»»å¿ƒâ€ã€â€œå›¢é˜Ÿç²¾ç¥â€ã€â€œç»†å¿ƒâ€ç­‰ï¼Œè¯´æ˜è¿™äº›å“è´¨æ˜¯æ•°æ®åˆ†æå²—æœ€ä¸ºçœ‹é‡çš„ã€‚æœ€ä¸‹æ–¹å³å›¾åˆ™æ˜¯å¯¹åº”è˜è€…çš„å­¦å†ã€ä¸“ä¸šçš„è¦æ±‚æè¿°ï¼Œè¦æ±‚æœ€å¤šçš„ä¸“ä¸šæ˜¯â€œç»Ÿè®¡å­¦â€ã€â€œæ•°å­¦â€ã€‚</p>

<p><img src="/assets/images/post_images/tagxedo.png" /></p>

<h4 id="2gmmèšç±»">2.GMMèšç±»</h4>
<p>GMMèšç±»æ˜¯ä¸€ç§åŸºäºæ¨¡å‹çš„èšç±»æ–¹æ³•ï¼Œå®ƒå¹¶ä¸è¦æ±‚æ¯ä¸ªæ–‡æœ¬åªå±äºä¸€ä¸ªç»„ï¼Œè€Œæ˜¯ç»™å‡ºä¸€ä¸ªæ–‡æœ¬å±äºä¸åŒç»„çš„æ¦‚ç‡ã€‚è¿™ç§èšç±»æ–¹æ³•ä¹Ÿå«â€œè½¯èšç±»â€ã€‚è¿™ç±»æ–¹æ³•é€šå¸¸å‡è®¾æ•°æ®æ»¡è¶³ä¸€å®šçš„æ¦‚ç‡åˆ†å¸ƒï¼Œèšç±»çš„è¿‡ç¨‹å°±æ˜¯è¦å°½åŠ›æ‰¾åˆ°æ•°æ®ä¸æ¨¡å‹ä¹‹é—´çš„æ‹Ÿåˆç‚¹ã€‚GMMå‡è®¾æ•°æ®æœä»é«˜æ–¯æ··åˆåˆ†å¸ƒï¼ˆGaussian Mixture Distributionï¼‰ï¼Œ
GMMä¸­çš„kä¸ªç»„ä»¶å¯¹åº”äºkä¸ªæ—ï¼Œæ‰€ä»¥GMMèšç±»çš„è¿‡ç¨‹å®é™…ä¸Šæ˜¯ä»¥ä¼¼ç„¶å‡½æ•°ä½œä¸ºè¯„åˆ†å‡½æ•°ï¼Œæ±‚ä½¿å¾—ä¼¼ç„¶å‡½æ•°æœ€å¤§åŒ–çš„kç»„$\omega$ ,$\mu$,$\Sigma$ å‚æ•°ã€‚</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#GMM æ–‡æœ¬èšç±»â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
</span><span class="kn">from</span> <span class="nn">sklearn.mixture</span> <span class="kn">import</span> <span class="n">GaussianMixture</span>
<span class="kn">from</span> <span class="nn">sklearn.feature_extraction.text</span> <span class="kn">import</span> <span class="n">HashingVectorizer</span><span class="p">,</span><span class="n">TfidfVectorizer</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>

<span class="c1">#os.chdir("E:/graduate/class/EDA/final")
</span><span class="s">"""
tfidf æå–1000ç»´ç‰¹å¾æ—¶ï¼ŒGMMè¾“å‡ºçš„æ¦‚ç‡ä¸æ˜¯0å°±æ˜¯1
ä¸çŸ¥é“æ˜¯å¦é™ç»´åGMMå¯ä»¥è¾“å‡ºæ¦‚ç‡ï¼Ÿï¼Ÿï¼Ÿ
"""</span>
<span class="k">def</span> <span class="nf">loadDataset</span><span class="p">(</span><span class="n">myfile</span><span class="p">):</span>
    <span class="s">'''å¯¼å…¥æ–‡æœ¬æ•°æ®é›†'''</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">myfile</span><span class="p">,</span><span class="s">'r'</span><span class="p">,</span><span class="n">encoding</span> <span class="o">=</span> <span class="s">"utf-8"</span><span class="p">)</span>
    <span class="n">dataset</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">():</span>
<span class="c1">#        print(line)
</span>        <span class="n">dataset</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">dataset</span>

<span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span><span class="n">n_features</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
    <span class="n">vectorizer</span> <span class="o">=</span> <span class="n">TfidfVectorizer</span><span class="p">(</span><span class="n">max_df</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">max_features</span><span class="o">=</span><span class="n">n_features</span><span class="p">,</span> <span class="n">min_df</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">use_idf</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">vectorizer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">X</span><span class="p">,</span><span class="n">vectorizer</span>

<span class="k">def</span> <span class="nf">gmm_train</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">vectorizer</span><span class="p">,</span><span class="n">n_components</span><span class="p">,</span><span class="n">showLable</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
 
    <span class="n">gmmModel</span> <span class="o">=</span> <span class="n">GaussianMixture</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="n">n_components</span><span class="p">,</span> <span class="n">covariance_type</span><span class="o">=</span><span class="s">'full'</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">gmmModel</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">toarray</span><span class="p">())</span>
    <span class="k">if</span> <span class="n">showLable</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Top terms per cluster:"</span><span class="p">)</span>
        <span class="n">order_centroids</span> <span class="o">=</span><span class="n">gmmModel</span><span class="o">.</span><span class="n">means_</span><span class="o">.</span><span class="n">argsort</span><span class="p">()[:,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">terms</span> <span class="o">=</span> <span class="n">vectorizer</span><span class="o">.</span><span class="n">get_feature_names</span><span class="p">()</span>
        <span class="k">print</span> <span class="p">(</span><span class="n">vectorizer</span><span class="o">.</span><span class="n">get_stop_words</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_components</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"Cluster </span><span class="si">%</span><span class="s">d:"</span> <span class="o">%</span> <span class="n">i</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s">''</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">order_centroids</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:</span><span class="mi">20</span><span class="p">]:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">' </span><span class="si">%</span><span class="s">s'</span> <span class="o">%</span> <span class="n">terms</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="n">end</span><span class="o">=</span><span class="s">''</span><span class="p">)</span>
            <span class="k">print</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">gmmModel</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">toarray</span><span class="p">()))</span> <span class="c1">#æ ‡ç­¾
</span>        <span class="k">print</span> <span class="p">(</span><span class="s">'Cluster distribution:'</span><span class="p">)</span>
        <span class="k">print</span> <span class="p">(</span><span class="nb">dict</span><span class="p">([(</span><span class="n">i</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">result</span><span class="p">]))</span>
    <span class="k">return</span> <span class="n">gmmModel</span>
    
<span class="n">dataset</span> <span class="o">=</span> <span class="n">loadDataset</span><span class="p">(</span><span class="s">'clean_text.txt'</span><span class="p">)</span>
<span class="n">X</span><span class="p">,</span><span class="n">vectorizer</span> <span class="o">=</span> <span class="n">transform</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span><span class="n">n_features</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>   
<span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">gmmModel</span> <span class="o">=</span> <span class="n">gmm_train</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">vectorizer</span><span class="p">,</span><span class="n">n_components</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">showLable</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>  <span class="c1">#èšæˆ7ç±»ä»¥ä¸Šæ˜¯å¯ä»¥æ¥å—çš„ç»“æœ 
</span><span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="s">"time cost:"</span><span class="p">,</span><span class="n">end</span><span class="o">-</span><span class="n">start</span><span class="p">)</span>  
<span class="n">gmm_labels</span> <span class="o">=</span> <span class="n">gmmModel</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">toarray</span><span class="p">())</span><span class="c1">#ç¬¬3ç±»æ˜¯æŠ€èƒ½è¦æ±‚
#p = gmmModel.predict_proba(X.toarray())
#np.round(p,2)
#
#print(gmmModel.weights_)
#print(gmmModel.means_)
#print(gmmModel.covariances_)
</span>


<span class="c1">#ç”¨jiebaæå–å…³é”®è¯
</span><span class="kn">from</span> <span class="nn">jieba.analyse</span> <span class="kn">import</span> <span class="n">extract_tags</span>

<span class="k">def</span> <span class="nf">get_labels_kw</span><span class="p">(</span><span class="n">clean_text</span><span class="p">,</span><span class="n">labels</span><span class="p">,</span><span class="n">name</span><span class="p">,</span> <span class="n">topK</span><span class="o">=</span><span class="mi">15</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get_label_i</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">clean_text</span> <span class="o">=</span> <span class="n">clean_text</span><span class="p">,</span><span class="n">labels</span> <span class="o">=</span> <span class="n">labels</span><span class="p">):</span> 
        <span class="s">"""è·å–ä¸åŒæ ‡ç­¾çš„æ–‡æœ¬"""</span>
        <span class="n">j</span><span class="o">=</span><span class="mi">0</span>
        <span class="n">period_i</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">clean_text</span><span class="p">))):</span>
            <span class="k">if</span> <span class="n">labels</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">:</span>
                <span class="n">period_i</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">clean_text</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"æ ‡ç­¾</span><span class="si">%</span><span class="s">dæœ‰</span><span class="si">%</span><span class="s">dæ¡æ–‡æœ¬"</span><span class="o">%</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">period_i</span><span class="p">)))</span>
        <span class="k">return</span> <span class="s">" "</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">period_i</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_kw</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">extract_tags</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">topK</span><span class="o">=</span><span class="n">topK</span><span class="p">,</span> <span class="n">withWeight</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">allowPOS</span><span class="o">=</span><span class="p">())</span>
    
    <span class="n">period_text</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">get_label_i</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">labels</span><span class="p">)))</span>
    <span class="n">news_kw</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">get_kw</span><span class="p">,</span><span class="n">period_text</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">news_kw</span><span class="p">)):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="si">%</span><span class="s">sæ–¹æ³•ç¬¬</span><span class="si">%</span><span class="s">dä¸ªç±»åˆ«çš„å…³é”®è¯ï¼š</span><span class="se">\n</span><span class="s">"</span><span class="o">%</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">news_kw</span><span class="p">[</span><span class="n">j</span><span class="p">])):</span>
            <span class="k">print</span><span class="p">(</span><span class="n">news_kw</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
 
<span class="n">get_labels_kw</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span><span class="n">gmm_labels</span><span class="p">,</span><span class="s">"gmm"</span><span class="p">)</span>    <span class="c1">#ç¬¬ä¸€ç±»æ˜¯æŠ€èƒ½è¦æ±‚
</span></code></pre></div></div>

<p>ç”±äºæ–‡æœ¬èšç±»çš„ç¨€ç–æ€§ï¼Œä¸”æœ¬æ–‡æ‰€ä½¿ç”¨å¥å­éƒ½æœ‰æ˜æ˜¾çš„ç‰¹å¾ï¼Œå› æ­¤GMMèšç±»åç»™å‡ºçš„æ¯ä¸ªå¥å­çš„æ¦‚ç‡éƒ½ååˆ†æ¥è¿‘0æˆ–1ï¼Œç›¸å½“äºkmeansçš„æ•ˆæœã€‚ç»è¿‡å¤šæ¬¡å°è¯•ä¸åŒçš„èšç±»ä¸ªæ•°ï¼Œå‘ç°æŠŠèšç±»ä¸ªæ•°å®šä¸º8ç±»æ—¶ï¼Œèƒ½å–å¾—è¾ƒå¥½çš„èšç±»æ•ˆæœï¼Œå„ä¸ªç±»åˆ«çš„å…³é”®è¯èƒ½ä½“ç°æ˜ç¡®çš„æ–‡æœ¬æ‘˜è¦ã€‚</p>

<p>è¡¨5å±•ç¤ºäº†æ¯ä¸ªèšç±»ä¸­å¿ƒçš„å…³é”®è¯ã€‚ä»ç±»åˆ«çš„æ ·æœ¬åˆ†å¸ƒå¯ä»¥çœ‹å‡ºï¼Œé™¤ç±»åˆ«3æœ‰1000å¤šæ¡æ ·æœ¬å¤–ï¼Œå…¶ä»–ç±»åˆ«æ ·æœ¬åˆ†å¸ƒå‡åŒ€ã€‚è¯´æ˜èŒä½æè¿°ä¸­ï¼Œç¯‡å¹…æœ€å¤§çš„æ˜¯æ—¥å¸¸å·¥ä½œä»»åŠ¡æè¿°ã€‚</p>

<p>ä»è¡¨ä¸­å…³é”®è¯å¯ä»¥çœ‹å‡ºï¼Œç¬¬1ã€6ç±»æ˜¯ä¸“ä¸šæŠ€èƒ½æè¿°ï¼Œç¬¬2ã€ 3ã€ 8ç±»æ˜¯ä»»åŠ¡æè¿°ï¼Œç¬¬4ç±»æ˜¯å®ä¹ æ—¶é—´æè¿°ï¼Œç¬¬5ç±»æ˜¯ä¸“ä¸šã€å­¦å†æè¿°ï¼Œç¬¬7ç±»æ˜¯é€šç”¨æŠ€èƒ½ã€å“è´¨æè¿°ã€‚å¦å¤–ï¼Œå°½ç®¡ç¬¬1ã€6ç±»æ˜¯ä¸“ä¸šæŠ€èƒ½æè¿°ï¼Œä½†å´ç•¥æœ‰ä¸åŒï¼Œç¬¬1ç±»å‡ºç°çš„è½¯ä»¶ä¸ºpythonã€javaã€hiveã€hadoopï¼Œè¿˜å‡ºç°äº†ç®—æ³•ã€æ•°æ®æŒ–æ˜ã€æœºå™¨å­¦ä¹ ç­‰è¯ï¼Œè¯´æ˜æ­¤ç±»èŒä½æè¿°çš„å¯¹ç¼–ç¨‹ã€å¯¹åˆ†å¸ƒå¼ã€ç®—æ³•è¦æ±‚æ›´é«˜äº›ï¼Œè€Œç¬¬6ç±»åˆ™åªæ˜¯è¦æ±‚åº”è˜è€…ä¼šofficeåŠå…¬è½¯ä»¶ï¼Œä»¥åŠä¼ ç»Ÿçš„sasã€spssç»Ÿè®¡åˆ†æè½¯ä»¶ï¼Œä¹Ÿè¦æ±‚pythonã€‚è¿™è¯´æ˜æ•°æ®åˆ†æå²—ä»å¯ä»¥å¾€ä¸‹ç»†åˆ†ä¸ºæ™®é€šç»Ÿè®¡åˆ†æå’Œåå‘ç®—æ³•å·¥ç¨‹å¸ˆçš„æ•°æ®åˆ†æã€‚</p>

<table>
  <thead>
    <tr>
      <th>ç±»åˆ«</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>æ ·æœ¬æ•°</td>
      <td>212</td>
      <td>179</td>
      <td>1163</td>
      <td>202</td>
      <td>220</td>
      <td>209</td>
      <td>301</td>
      <td>331</td>
    </tr>
    <tr>
      <td>å…³é”®è¯</td>
      <td>ç†Ÿæ‚‰ äº†è§£ python sql ä¸€å®š å·¥å…· æ•°æ®æŒ–æ˜ ç†Ÿç»ƒæŒæ¡ ä¸€ç§ ç®—æ³• æŒæ¡ è¯­è¨€ ç»éªŒ æ–¹æ³• hive æ•°æ®åº“ java hadoop å¸¸ç”¨ æœºå™¨å­¦ä¹ </td>
      <td>æä¾› æ”¯æŒ è¿è¥ äº§å“ å†³ç­– æ—¥å¸¸ æŠ¥å‘Š éƒ¨é—¨ ååŠ© æŠ¥è¡¨ å…¬å¸ æä¾›æ•°æ® ç›¸å…³ å›¢é˜Ÿ éœ€æ±‚ åŒ…æ‹¬ ä¼˜åŒ– æŒ‡æ ‡ å»ºè®® ç”¨æˆ·</td>
      <td>ç›¸å…³ å®Œæˆ ç»éªŒ é¡¹ç›® ååŠ© å…¬å¸ æŠ¥å‘Š æ•´ç† ç ”ç©¶ å‚ä¸ è¡Œä¸š éƒ¨é—¨ ç»´æŠ¤ ç³»ç»Ÿ å­¦ä¹  ç®¡ç† æ’°å†™ äº§å“ é—®é¢˜ å¹³å°</td>
      <td>å®ä¹  ä»¥ä¸Š æ¯å‘¨ è‡³å°‘ æ¥å— é•¿æœŸ æ—¶é—´ æš‘æœŸå®ä¹  ä¿è¯ ä¸€å‘¨ å®ä¹ æœŸ èƒ½å¤Ÿ å¤©åŠ è½¬æ­£ ç»éªŒ å·¥ä½œæ—¥ å…¨èŒ æœŸé—´ è€ƒè™‘ å››å¤©</td>
      <td>æ•°å­¦ ä»¥ä¸Šå­¦å† ç›¸å…³ä¸“ä¸š æœ¬ç§‘ è®¡ç®—æœº ç»Ÿè®¡å­¦ ä¸“ä¸š  ç¡•å£« ç ”ç©¶ç”Ÿ é‡‘è ç»æµå­¦ åœ¨è¯» å…¨æ—¥åˆ¶  å¤§å­¦æœ¬ç§‘</td>
      <td>ä½¿ç”¨ ç†Ÿç»ƒ excel sql è½¯ä»¶ ppt åŠå…¬è½¯ä»¶ python å·¥å…· ç†Ÿæ‚‰ office æ“ä½œ spss ç†Ÿç»ƒæŒæ¡ å¸¸ç”¨ æŒæ¡ ç²¾é€š sas è¿ç”¨</td>
      <td>æ²Ÿé€š è‰¯å¥½ å…·å¤‡ å­¦ä¹  è´£ä»»å¿ƒ é€»è¾‘æ€ç»´ è¾ƒå¼º å›¢é˜Ÿåä½œ æ•æ„Ÿ å›¢é˜Ÿ åè°ƒ é€»è¾‘ åˆä½œç²¾ç¥ è¡¨è¾¾èƒ½åŠ› ä¼˜ç§€ æ•æ„Ÿåº¦ æŠ—å‹ å–„äº ç²¾ç¥</td>
      <td>è¿›è¡Œ éœ€æ±‚ ç”¨æˆ· æå‡º æ•´ç† ååŠ© äº§å“ æŠ¥å‘Š æ¨¡å‹ ç›¸å…³ é¡¹ç›® ç†è§£ æŒ–æ˜ è¡Œä¸º ä¼˜åŒ– æ”¶é›† å»ºè®® ä¸šåŠ¡éƒ¨é—¨ ä¿¡æ¯ ç ”ç©¶</td>
    </tr>
  </tbody>
</table>

<h4 id="3nmfèšç±»">3.NMFèšç±»</h4>
<p>NMFæ˜¯ä¸€ç§éçº¿æ€§é™ç»´æ–¹æ³•ï¼Œé™ç»´åçš„çŸ©é˜µç›¸å½“äºå¯¹åŸæ–‡æ¡£è¯é¢‘çŸ©é˜µè¿›è¡Œäº†ç‰¹å¾æå–ï¼Œè¿‡æ»¤å™ªå£°ç‰¹å¾é¡¹ï¼Œå› æ­¤æå–çš„ç‰¹å¾æ›´èƒ½åæ˜ æ ·æœ¬çš„å±€éƒ¨ç‰¹å¾ï¼Œèšç±»æ•ˆæœæ›´å¥½ã€‚NMFèšç±»çš„ç»“æœå¦‚è¡¨6æ‰€ç¤ºï¼Œå¯ä»¥çœ‹åˆ°NMFä»…èšæˆ5ä¸ªç±»åˆ«ï¼Œå³å¯ä½¿æ¯ä¸ªç±»åˆ«çš„æ–‡æœ¬æœ‰æ¸…æ™°æ˜ç¡®çš„æ–‡æœ¬æ‘˜è¦ã€‚</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># NMF-based clustering-------------------------------------------------
#    ||X - UVT||
</span><span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">NMF</span>
<span class="kn">from</span> <span class="nn">numpy.linalg</span> <span class="kn">import</span> <span class="n">norm</span>

<span class="k">def</span> <span class="nf">nmf_train</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">n_components</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">NMF</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="n">n_components</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="s">'random'</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">U</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
    <span class="n">VT</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">components_</span>    
    
    <span class="c1">#1000ä¸ªè¯ï¼Œk = 10ï¼Œæ–‡æ¡£æ•°2772
</span>    <span class="c1"># å½’ä¸€åŒ–
</span>    <span class="n">V</span> <span class="o">=</span> <span class="n">VT</span><span class="o">.</span><span class="n">T</span>
    
    <span class="n">nu</span><span class="p">,</span><span class="n">pu</span> <span class="o">=</span> <span class="n">U</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">nv</span><span class="p">,</span><span class="n">pv</span> <span class="o">=</span> <span class="n">V</span><span class="o">.</span><span class="n">shape</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nv</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">pv</span><span class="p">):</span>
            <span class="n">V</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">V</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">norm</span><span class="p">(</span><span class="n">U</span><span class="p">[:,</span><span class="n">j</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">pu</span><span class="p">):</span>
        <span class="n">U</span><span class="p">[:,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">U</span><span class="p">[:,</span><span class="n">j</span><span class="p">]</span><span class="o">/</span><span class="n">norm</span><span class="p">(</span><span class="n">U</span><span class="p">[:,</span><span class="n">j</span><span class="p">])</span>
    <span class="c1">#ä½¿ç”¨çŸ©é˜µHæ¥å†³å®šæ¯ä¸ªæ–‡æ¡£çš„å½’ç±»ã€‚é‚£ä¸ªæ–‡æ¡£diçš„ç±»æ ‡ä¸ºmï¼Œå½“ï¼šm = argmaxj{vij}
</span>    <span class="n">V</span><span class="o">.</span><span class="n">shape</span> <span class="c1">#(2773, 10)
</span>    <span class="n">nmf_labels</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">,</span><span class="n">V</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">nmf_labels</span>

<span class="kn">from</span> <span class="nn">jieba.analyse</span> <span class="kn">import</span> <span class="n">extract_tags</span>

<span class="k">def</span> <span class="nf">get_labels_kw</span><span class="p">(</span><span class="n">clean_text</span><span class="p">,</span><span class="n">labels</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">topK</span><span class="o">=</span><span class="mi">15</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get_label_i</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">clean_text</span> <span class="o">=</span> <span class="n">clean_text</span><span class="p">,</span><span class="n">labels</span> <span class="o">=</span> <span class="n">labels</span><span class="p">):</span> 
        <span class="s">"""è·å–ä¸åŒæ ‡ç­¾çš„æ–‡æœ¬"""</span>
        <span class="n">j</span><span class="o">=</span><span class="mi">0</span>
        <span class="n">period_i</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">clean_text</span><span class="p">))):</span>
            <span class="k">if</span> <span class="n">labels</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">:</span>
                <span class="n">period_i</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">clean_text</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"æ ‡ç­¾</span><span class="si">%</span><span class="s">dæœ‰</span><span class="si">%</span><span class="s">dæ¡æ–‡æœ¬"</span><span class="o">%</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">period_i</span><span class="p">)))</span>
        <span class="k">return</span> <span class="s">" "</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">period_i</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_kw</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">extract_tags</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">topK</span><span class="o">=</span><span class="n">topK</span><span class="p">,</span> <span class="n">withWeight</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">allowPOS</span><span class="o">=</span><span class="p">())</span>
    
    <span class="n">period_text</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">get_label_i</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">labels</span><span class="p">)))</span>
    <span class="n">news_kw</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">get_kw</span><span class="p">,</span><span class="n">period_text</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">news_kw</span><span class="p">)):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="si">%</span><span class="s">sæ–¹æ³•ç¬¬</span><span class="si">%</span><span class="s">dä¸ªç±»åˆ«çš„å…³é”®è¯ï¼š</span><span class="se">\n</span><span class="s">"</span><span class="o">%</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">news_kw</span><span class="p">[</span><span class="n">j</span><span class="p">])):</span>
            <span class="k">print</span><span class="p">(</span><span class="n">news_kw</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
            
<span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>     
<span class="n">nmf_labels</span> <span class="o">=</span> <span class="n">nmf_train</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">n_components</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span> <span class="c1">#èšæˆ5/6/7ç±»çš„æ•ˆæœè¿˜è¡Œ
</span><span class="n">get_labels_kw</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span><span class="n">nmf_labels</span><span class="p">,</span><span class="s">"nmf"</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>   <span class="c1">#ç¬¬0ç±»æ˜¯æŠ€èƒ½è¦æ±‚  
</span><span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="s">"time cost:"</span><span class="p">,</span><span class="n">end</span><span class="o">-</span><span class="n">start</span><span class="p">)</span>  
</code></pre></div></div>

<table>
  <thead>
    <tr>
      <th>ç±»åˆ«</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>æ ·æœ¬æ•°</td>
      <td>275</td>
      <td>1355</td>
      <td>389</td>
      <td>480</td>
      <td>318</td>
    </tr>
    <tr>
      <td>å…³é”®è¯</td>
      <td>ä»¥ä¸Šå­¦å†   ä¸“ä¸š   æœ¬ç§‘   æ•°å­¦   ç»Ÿè®¡å­¦   ç›¸å…³   è®¡ç®—æœº   ç»Ÿè®¡   åœ¨è¯»   ç ”ç©¶ç”Ÿ   ä¸“ä¸šæœ¬ç§‘   å…¨æ—¥åˆ¶   ç¡•å£«   å¤§ä¸‰   é‡‘è</td>
      <td>ååŠ©   ç›¸å…³   æ•°æ®æŒ–æ˜   è¿›è¡Œ   è¿è¥   æŠ¥å‘Š   éœ€æ±‚   ç”¨æˆ·   æ•´ç†   é¡¹ç›®   äº§å“   å®Œæˆ   æŠ¥è¡¨   å»ºæ¨¡   æ”¯æŒ</td>
      <td>excel   ç†Ÿç»ƒ   sql   python   ä½¿ç”¨   è½¯ä»¶   ç†Ÿæ‚‰   ppt   ç†Ÿç»ƒæŒæ¡   å·¥å…·   sas   office   åŠå…¬   spss   æ•°æ®åº“</td>
      <td>æ²Ÿé€š   è‰¯å¥½   å›¢é˜Ÿ   å…·å¤‡   å­¦ä¹    è´£ä»»å¿ƒ   é€»è¾‘æ€ç»´   ç²¾ç¥   å…·æœ‰   é€»è¾‘   åˆä½œ   è¡¨è¾¾èƒ½åŠ›   è¾ƒå¼º   æŠ—å‹   æ•æ„Ÿ</td>
      <td>å®ä¹    æ¯å‘¨   ä»¥ä¸Š   æš‘æœŸ   è‡³å°‘   æ¥å—   æ—¶é—´   é•¿æœŸ   å®ä¹ æœŸ   è½¬æ­£   ä¿è¯   ä¸€å‘¨   å…¨èŒ   å®ä¹ ç”Ÿ</td>
    </tr>
    <tr>
      <td>Â </td>
      <td>Â </td>
      <td>Â </td>
      <td>Â </td>
      <td>Â </td>
      <td>Â </td>
    </tr>
  </tbody>
</table>

<h2 id="èšç±»æ–¹æ³•çš„æ¯”è¾ƒ">èšç±»æ–¹æ³•çš„æ¯”è¾ƒ</h2>
<h4 id="1èšç±»æ•ˆæœ">1.èšç±»æ•ˆæœ</h4>
<p>ä»ä»¥ä¸Šå±•ç¤ºçš„èšç±»æ•ˆæœæ¥çœ‹ï¼ŒNMFçš„èšç±»ç±»åˆ«æœ€å°‘ï¼Œä»…5ç±»å°±å¯ä»¥ä½¿å¾—æ¯ä¸ªç±»åˆ«å…·æœ‰æ˜ç¡®æ¸…æ™°çš„ï¼Œç¬¦åˆé¢„å…ˆè®¾æƒ³çš„æ–‡æœ¬æ‘˜è¦ã€‚
ä»èšç±»ç®—æ³•è¿è¡Œé€Ÿåº¦æ¥çœ‹ï¼ŒåŒæ ·éƒ½æ˜¯ä»pythonä¸­sklearnè°ƒç”¨çš„å‡½æ•°ï¼ŒNMFæœ€å¿«,ä»…éœ€è¦0.46sï¼›kmeansä¸ä¹‹ç›¸å·®æ— å‡ ï¼Œéœ€0.56sï¼Œ GMMæœ€æ…¢ï¼Œéœ€è¦16.78sæ‰èƒ½è¿è¡Œå®Œæ¯•ã€‚</p>
<h4 id="2å…°å¾·æŒ‡æ•°">2.å…°å¾·æŒ‡æ•°</h4>
<p>å…°å¾·æŒ‡æ•°æ˜¯ä¸€ç§åŸºäºèšç±»ç›¸ä¼¼åº¦çš„è¯„ä»·æŒ‡æ ‡ï¼Œå®ƒé€šè¿‡è§‚å¯Ÿä¸€å¯¹æ ·æœ¬ç‚¹xi,yiåœ¨ä¸¤ç§èšç±»æ–¹æ³•ä¸­æ˜¯å¦è¢«åˆ†åœ¨åŒä¸€ä¸ªç±»åˆ«æ¥åˆ¤æ–­ä¸¤ç§èšç±»æ–¹æ³•çš„ç›¸ä¼¼æ€§ã€‚ä»è¡¨7å¯ä»¥çœ‹å‡ºï¼ŒGMMã€kmeansä¸NMFçš„èšç±»æ•ˆæœç›¸ä¼¼åº¦ä½ï¼Œå…°å¾·æŒ‡æ•°å°‘äº0.3ï¼›kmeanså’ŒGMMçš„èšç±»æ•ˆæœè¾ƒç›¸ä¼¼ï¼Œä¸¤è€…çš„å…°å¾·æŒ‡æ•°ä¸º0.43ï¼Œè¯´æ˜ä¸¤è€…ä¸­æœ‰43%å¯¹æ ·æœ¬ç‚¹æ˜¯åˆ†åœ¨äº†åŒä¸€ä¸ªç±»åˆ«æˆ–ä¸åœ¨åŒä¸€ä¸ªç±»åˆ«ã€‚è¿™å¯èƒ½æ˜¯å› ä¸ºGMMæ˜¯k-Meansæ–¹æ³•çš„æ¦‚ç‡å˜ç§ï¼Œå…¶åŸºæœ¬ç®—æ³•æ¡†æ¶å’Œk-Meansç±»ä¼¼ï¼Œéƒ½æ˜¯é€šè¿‡å¤šæ¬¡è¿­ä»£é€æ­¥æ”¹è¿›èšç±»ç»“æœçš„è´¨é‡ã€‚</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#èšç±»æ•ˆæœæ¯”è¾ƒâ€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
# å…°å¾·æŒ‡æ•°ï¼šæ¯”è¾ƒèšç±»æ•ˆæœçš„ç›¸ä¼¼æ€§
</span><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">adjusted_rand_score</span>  
<span class="n">adjusted_rand_score</span><span class="p">(</span><span class="n">km</span><span class="o">.</span><span class="n">labels_</span><span class="p">,</span><span class="n">gmm_labels</span><span class="p">)</span>    <span class="c1">#ç›¸ä¼¼åº¦ä½ã€‚ã€‚
</span><span class="n">adjusted_rand_score</span><span class="p">(</span><span class="n">km</span><span class="o">.</span><span class="n">labels_</span><span class="p">,</span><span class="n">nmf_labels</span><span class="p">)</span>     
<span class="n">adjusted_rand_score</span><span class="p">(</span><span class="n">gmm_labels</span><span class="p">,</span><span class="n">nmf_labels</span><span class="p">)</span>       
<span class="c1"># è½®å»“ç³»æ•°
</span><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">silhouette_score</span>
<span class="n">silhouette_score</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">km</span><span class="o">.</span><span class="n">labels_</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s">'euclidean'</span><span class="p">)</span>
<span class="n">silhouette_score</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">gmm_labels</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s">'euclidean'</span><span class="p">)</span>
<span class="n">silhouette_score</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">nmf_labels</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s">'euclidean'</span><span class="p">)</span>

</code></pre></div></div>

<table>
  <thead>
    <tr>
      <th>å…°å¾·æŒ‡æ•°</th>
      <th style="text-align: center">Kmeans</th>
      <th style="text-align: right">GMM</th>
      <th>NMF</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Kmeans</td>
      <td style="text-align: center">Â </td>
      <td style="text-align: right">Â </td>
      <td>Â </td>
    </tr>
    <tr>
      <td>GMM</td>
      <td style="text-align: center">0.4310</td>
      <td style="text-align: right">Â </td>
      <td>Â </td>
    </tr>
    <tr>
      <td>NMF</td>
      <td style="text-align: center">0.2480</td>
      <td style="text-align: right">0.2862</td>
      <td>Â </td>
    </tr>
  </tbody>
</table>

<h2 id="ldaèšç±»">LDAèšç±»</h2>
<h4 id="1-ä¸»é¢˜æ•°ä¸º6æ—¶å„ä¸ªä¸»é¢˜çš„å…³é”®è¯èƒ½å½¢æˆæ˜ç¡®çš„æ–‡æœ¬æ‘˜è¦">1. ä¸»é¢˜æ•°ä¸º6æ—¶å„ä¸ªä¸»é¢˜çš„å…³é”®è¯èƒ½å½¢æˆæ˜ç¡®çš„æ–‡æœ¬æ‘˜è¦</h4>
<p>èšç±»ç»“æœä¸kmeansç±»ä¼¼</p>

<h4 id="2ä¸»é¢˜æ•°ä¸º10æ—¶æŠ€èƒ½ä¸»é¢˜åˆ†åŒ–">2.ä¸»é¢˜æ•°ä¸º10æ—¶æŠ€èƒ½ä¸»é¢˜åˆ†åŒ–</h4>
<p>å½“LDAæå–çš„ä¸»é¢˜æ•°è®¾ä¸º10æ—¶ï¼Œå¦‚å›¾2æ‰€ç¤ºï¼Œå‡ºç°äº†ä¸¤ä¸ªä¸“ä¸šæŠ€èƒ½ä¸»é¢˜ï¼Œå´ç•¥æœ‰ä¸åŒï¼Œä¸€ä¸ªä¸»é¢˜ä¸­å‡ºç°çš„è½¯ä»¶ä¸ºpythonã€javaã€hiveã€hadoopï¼Œè¿˜å‡ºç°äº†ç®—æ³•ã€æ•°æ®æŒ–æ˜ã€æœºå™¨å­¦ä¹ ç­‰è¯ï¼Œè¯´æ˜æ­¤ç±»èŒä½æè¿°çš„å¯¹ç¼–ç¨‹ã€å¯¹åˆ†å¸ƒå¼ã€ç®—æ³•è¦æ±‚æ›´é«˜äº›ï¼Œè€Œå¦ä¸€ä¸ªä¸»é¢˜åˆ™åªæ˜¯è¦æ±‚åº”è˜è€…ä¼šofficeåŠå…¬è½¯ä»¶ï¼Œä»¥åŠä¼ ç»Ÿçš„sasã€spssç»Ÿè®¡åˆ†æè½¯ä»¶ï¼Œä¹Ÿè¦æ±‚pythonã€‚è¿™è¯´æ˜æ•°æ®åˆ†æå²—ä»å¯ä»¥å¾€ä¸‹ç»†åˆ†ä¸ºæ™®é€šç»Ÿè®¡åˆ†æå’Œåå‘ç®—æ³•å·¥ç¨‹å¸ˆã€å¤§æ•°æ®æ–¹é¢çš„æ•°æ®åˆ†æã€‚</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#LDA-------------------------------------------------------------------
</span><span class="kn">from</span> <span class="nn">gensim</span> <span class="kn">import</span> <span class="n">corpora</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span> <span class="nn">gensim.models</span> <span class="kn">import</span> <span class="n">LdaModel</span>


<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s">"/Users/situ/Documents/EDA/final"</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">loadDataset</span><span class="p">(</span><span class="n">myfile</span><span class="p">):</span>
    <span class="s">'''å¯¼å…¥æ–‡æœ¬æ•°æ®é›†'''</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">myfile</span><span class="p">,</span><span class="s">'r'</span><span class="p">,</span><span class="n">encoding</span> <span class="o">=</span> <span class="s">"utf-8"</span><span class="p">)</span>
    <span class="n">dataset</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">():</span>
<span class="c1">#        print(line)
</span>        <span class="n">dataset</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>

    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">dataset</span>


<span class="n">clean_text4</span> <span class="o">=</span> <span class="n">loadDataset</span><span class="p">(</span><span class="s">"clean_text.txt"</span><span class="p">)</span>
<span class="n">TEMP_FOLDER</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">gettempdir</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="s">'Folder "{}" will be used to save temporary dictionary and corpus.'</span><span class="o">.</span><span class="nb">format</span><span class="p">(</span><span class="n">TEMP_FOLDER</span><span class="p">))</span>
<span class="n">dictionary</span> <span class="o">=</span> <span class="n">corpora</span><span class="o">.</span><span class="n">Dictionary</span><span class="p">(</span><span class="n">clean_text4</span><span class="p">)</span>
<span class="n">dictionary</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">TEMP_FOLDER</span><span class="p">,</span> <span class="s">'deerwester.dict'</span><span class="p">))</span>  <span class="c1"># store the dictionary, for future reference
</span><span class="k">print</span><span class="p">(</span><span class="n">dictionary</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">dictionary</span><span class="o">.</span><span class="n">token2id</span><span class="p">)</span>
<span class="n">corpus</span> <span class="o">=</span> <span class="p">[</span><span class="n">dictionary</span><span class="o">.</span><span class="n">doc2bow</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="k">for</span> <span class="n">text</span> <span class="ow">in</span> <span class="n">clean_text4</span><span class="p">]</span>

<span class="n">corpora</span><span class="o">.</span><span class="n">MmCorpus</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">TEMP_FOLDER</span><span class="p">,</span> <span class="s">'deerwester.mm'</span><span class="p">),</span> <span class="n">corpus</span><span class="p">)</span>  <span class="c1"># store to disk, for later use
</span><span class="nb">len</span><span class="p">(</span><span class="n">corpus</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">'Number of unique tokens: </span><span class="si">%</span><span class="s">d'</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">dictionary</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s">'Number of documents: </span><span class="si">%</span><span class="s">d'</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">corpus</span><span class="p">))</span>


<span class="c1"># Set training parameters.
</span><span class="n">num_topics</span> <span class="o">=</span> <span class="mi">5</span>
<span class="c1">#10 8
</span><span class="n">chunksize</span> <span class="o">=</span> <span class="mi">2000</span>
<span class="n">passes</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">iterations</span> <span class="o">=</span> <span class="mi">400</span>
<span class="n">eval_every</span> <span class="o">=</span> <span class="bp">None</span>  <span class="c1"># Don't evaluate model perplexity, takes too much time.
</span>
<span class="c1"># Make a index to word dictionary.
</span><span class="n">temp</span> <span class="o">=</span> <span class="n">dictionary</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># This is only to "load" the dictionary.
</span><span class="n">id2word</span> <span class="o">=</span> <span class="n">dictionary</span><span class="o">.</span><span class="n">id2token</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">LdaModel</span><span class="p">(</span><span class="n">corpus</span><span class="o">=</span><span class="n">corpus</span><span class="p">,</span> <span class="n">id2word</span><span class="o">=</span><span class="n">id2word</span><span class="p">,</span> <span class="n">chunksize</span><span class="o">=</span><span class="n">chunksize</span><span class="p">,</span> \
                       <span class="n">alpha</span><span class="o">=</span><span class="s">'auto'</span><span class="p">,</span> <span class="n">eta</span><span class="o">=</span><span class="s">'auto'</span><span class="p">,</span> \
                       <span class="n">iterations</span><span class="o">=</span><span class="n">iterations</span><span class="p">,</span> <span class="n">num_topics</span><span class="o">=</span><span class="n">num_topics</span><span class="p">,</span> \
                       <span class="n">passes</span><span class="o">=</span><span class="n">passes</span><span class="p">,</span> <span class="n">eval_every</span><span class="o">=</span><span class="n">eval_every</span><span class="p">)</span>

<span class="n">top_topics</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">top_topics</span><span class="p">(</span><span class="n">corpus</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>

<span class="c1"># Average topic coherence is the sum of topic coherences of all topics, divided by the number of topics.
</span><span class="n">avg_topic_coherence</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">top_topics</span><span class="p">])</span> <span class="o">/</span> <span class="n">num_topics</span>
<span class="k">print</span><span class="p">(</span><span class="s">'Average topic coherence: </span><span class="si">%.4</span><span class="s">f.'</span> <span class="o">%</span> <span class="n">avg_topic_coherence</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">top_topics</span><span class="p">)</span>


<span class="n">model</span><span class="o">.</span><span class="n">print_topic</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">30</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">print_topic</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">30</span><span class="p">)</span>

<span class="c1">#åˆ¤æ–­ä¸€ä¸ªè®­ç»ƒé›†æ–‡æ¡£å±äºå“ªä¸ªä¸»é¢˜
</span><span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">score</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">model</span><span class="p">[</span><span class="n">corpus</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">tup</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">tup</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Score: {}</span><span class="se">\t</span><span class="s"> Topic: {}"</span><span class="o">.</span><span class="nb">format</span><span class="p">(</span><span class="n">score</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">print_topic</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="mi">10</span><span class="p">)))</span>
    
 
<span class="c1">#ç»™è®­ç»ƒé›†è¾“å‡ºå…¶å±äºä¸åŒä¸»é¢˜æ¦‚ç‡   
</span><span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">score</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">model</span><span class="p">[</span><span class="n">corpus</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">tup</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">tup</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
    <span class="k">print</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">score</span><span class="p">)</span>
    
    
    
    
<span class="c1">#åˆ¤æ–­ä¸€ä¸ªæµ‹è¯•é›†æ–‡æ¡£å±äºå“ªä¸ªä¸»é¢˜
#unseen_document = [" ".join(text_i) for text_i in clean_text4[130]]
#unseen_document = " ".join(unseen_document)
</span>    
<span class="n">unseen_document</span> <span class="o">=</span> <span class="n">text</span><span class="p">[</span><span class="mi">130</span><span class="p">]</span>
<span class="s">"""
è¿˜è¦å¯¹æ–‡æ¡£è¿›è¡Œä¹‹å‰çš„æ–‡æœ¬é¢„å¤„ç†
"""</span>


<span class="n">bow_vector</span> <span class="o">=</span> <span class="n">dictionary</span><span class="o">.</span><span class="n">doc2bow</span><span class="p">(</span><span class="n">unseen_document</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">score</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">model</span><span class="p">[</span><span class="n">bow_vector</span><span class="p">],</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">tup</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">tup</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Score: {}</span><span class="se">\t</span><span class="s"> Topic: {}"</span><span class="o">.</span><span class="nb">format</span><span class="p">(</span><span class="n">score</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">print_topic</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="mi">10</span><span class="p">)))</span>

<span class="c1">#ç»™æ¯ä¸ªå®Œæ•´çš„åˆ†è¯åçš„æ–‡æ¡£ç”Ÿæˆä¸åŒä¸»é¢˜çš„å¾—åˆ†
</span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">"data_with_wordseg.csv"</span><span class="p">,</span><span class="n">encoding</span> <span class="o">=</span> <span class="s">"gbk"</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
<span class="n">lda_score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">num_topics</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">"word_seg"</span><span class="p">])):</span>
    <span class="n">line</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">"word_seg"</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
    <span class="n">bow_vector</span> <span class="o">=</span> <span class="n">dictionary</span><span class="o">.</span><span class="n">doc2bow</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">score</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">model</span><span class="p">[</span><span class="n">bow_vector</span><span class="p">],</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">tup</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">tup</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">lda_score</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">score</span>
<span class="n">lda_score</span><span class="p">[:</span><span class="mi">5</span><span class="p">,:]</span>
<span class="n">lda_score_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">lda_score</span><span class="p">,</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s">"lda"</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_topics</span><span class="p">)])</span>
<span class="n">lda_score_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">data</span><span class="p">,</span> <span class="n">lda_score_df</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s">"data_with_lda_score.csv"</span><span class="p">,</span><span class="n">index</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span><span class="n">encoding</span> <span class="o">=</span> <span class="s">"gbk"</span><span class="p">)</span>


<span class="c1">#LDA visualization---------------------------------------------------
</span>
<span class="kn">import</span> <span class="nn">pyLDAvis</span>
<span class="kn">import</span> <span class="nn">pyLDAvis.gensim</span>

<span class="n">vis_wrapper</span> <span class="o">=</span> <span class="n">pyLDAvis</span><span class="o">.</span><span class="n">gensim</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">corpus</span><span class="p">,</span><span class="n">dictionary</span><span class="p">)</span>
<span class="n">pyLDAvis</span><span class="o">.</span><span class="n">display</span><span class="p">(</span><span class="n">vis_wrapper</span><span class="p">)</span>
<span class="n">pyLDAvis</span><span class="o">.</span><span class="n">save_html</span><span class="p">(</span><span class="n">vis_wrapper</span><span class="p">,</span><span class="s">"lda</span><span class="si">%</span><span class="s">dtopics.html"</span><span class="o">%</span><span class="n">num_topics</span><span class="p">)</span>


<span class="c1">#pyLDAvis.enable_notebook()
#pyLDAvis.prepare(mds='tsne', **movies_model_data)
</span></code></pre></div></div>

<p><img src="/assets/images/post_images/LDA.png" /></p>

<h2 id="å‚è€ƒåšå®¢">å‚è€ƒåšå®¢ï¼š</h2>
<p>æè¿°ç»Ÿè®¡å‚è€ƒï¼š</p>

<ul>
  <li><a href="https://zhuanlan.zhihu.com/p/25704059">æ•°æ®åˆ†æå¸ˆæŒ£å¤šå°‘é’±ï¼Ÿâ€œé»‘â€äº†æ‹›è˜ç½‘ç«™å‘Šè¯‰ä½ ï¼</a></li>
</ul>

<p>æ¨¡å‹å‚è€ƒï¼š</p>

<ul>
  <li><a href="https://www.zhihu.com/question/39254526">åˆ©ç”¨pythonåšLDAæ–‡æœ¬åˆ†æï¼Œè¯¥ä»å“ªé‡Œå…¥æ‰‹å‘¢ï¼Ÿ</a></li>
</ul>
:ET