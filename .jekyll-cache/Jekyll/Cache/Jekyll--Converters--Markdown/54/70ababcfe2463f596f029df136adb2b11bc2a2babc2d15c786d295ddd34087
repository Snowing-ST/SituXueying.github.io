I"ña<font face="ä»¿å®‹">ç”¨scrapyæ¡†æ¶çˆ¬å–åœ¨[æ–°æµªæ–°é—»](search.sina.com.cn)ä¸­ç”¨å…³é”®è¯æœç´¢çš„ç»“æœã€‚</font>

<p>scrapyä¼˜åŠ¿ï¼š</p>
<ol>
  <li>æ–°å»ºçˆ¬è™«é¡¹ç›®æ—¶ï¼Œåªéœ€æ”¹åŠ¨åŸå› æ¡†æ¶ä¸€äº›å†…å®¹ï¼Œæ— éœ€ä»å¤´å†™ä»£ç </li>
  <li>æ‰§è¡Œç¨‹åºæ—¶ï¼Œåœ¨ä¸€å®šèŒƒå›´å†…çˆ¬å–å‡ºé”™è‡ªåŠ¨è·³è¿‡ï¼Œä¸ä¼šæ‰“æ–­ç¨‹åºï¼Œæ— éœ€å®šä¹‰å‡ºé”™è¯†åˆ«å’Œå¤„ç†åŠæ³•</li>
</ol>

<h3 id="å®‰è£…crapy">å®‰è£…crapy</h3>

<p>æ‰“å¼€anaconda promptï¼Œè¾“å…¥<code class="highlighter-rouge">pip install scrapy</code></p>

<h3 id="æ–°å»ºscrapyé¡¹ç›®">æ–°å»ºscrapyé¡¹ç›®</h3>

<p>é¡¹ç›®åç§°ä¸º<code class="highlighter-rouge">newsSpider</code></p>

<h4 id="1-æ‰“å¼€anaconda-promptcdåˆ°åˆ°æŒ‡å®šæ–‡ä»¶å¤¹è¾“å…¥scrapy-startproject-newsspider">1. æ‰“å¼€anaconda promptï¼Œcdåˆ°åˆ°æŒ‡å®šæ–‡ä»¶å¤¹ï¼Œè¾“å…¥ï¼š<code class="highlighter-rouge">scrapy startproject newsSpider</code>ï¼Œ</h4>
<h4 id="2-å†è¾“å…¥tree-newsspiderå¯çœ‹åˆ°è¯¥æ–‡ä»¶å¤¹ä¸­è‡ªåŠ¨ç”Ÿæˆä»¥ä¸‹æ–‡ä»¶">2. å†è¾“å…¥<code class="highlighter-rouge">tree newsSpider</code>å¯çœ‹åˆ°è¯¥æ–‡ä»¶å¤¹ä¸­è‡ªåŠ¨ç”Ÿæˆä»¥ä¸‹æ–‡ä»¶ï¼š</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>newsSpider/
    scrapy.cfg            # deploy configuration file
    newsSpider/             # project's Python module, you'll import your code from here
        __init__.py
        items.py          # project items definition file
        middlewares.py    # project middlewares file
        pipelines.py      # project pipelines file
        settings.py       # project settings file
        spiders/          # a directory where you'll later put your spiders
            __init__.py
</code></pre></div></div>
<h4 id="3-æœ€åcdåˆ°newsspidernewsspiderspidersä¸­è¾“å…¥scrapy-genspider-traderwar-searchsinacomcn">3. æœ€åcdåˆ°<code class="highlighter-rouge">./newsSpider/newsSpider/spiders</code>ä¸­ï¼Œè¾“å…¥<code class="highlighter-rouge">scrapy genspider TraderWar search.sina.com.cn</code></h4>
<p>åˆ™ç”Ÿæˆ<code class="highlighter-rouge">TraderWar.py</code>æ ¸å¿ƒçˆ¬è™«æ–‡ä»¶ï¼Œå…¶ä¸­æœ‰ä¸€è¡Œä¸º<code class="highlighter-rouge">allowed_domains = ["search.sina.com.cn"]</code>ï¼Œå³æŒ‡å®šäº†çˆ¬è™«ç½‘ç«™ã€‚</p>

<h3 id="æ”¹å†™æ ¸å¿ƒçˆ¬è™«æ–‡ä»¶">æ”¹å†™æ ¸å¿ƒçˆ¬è™«æ–‡ä»¶</h3>

<p><code class="highlighter-rouge">TraderWar.py</code> åˆå§‹ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">scrapy</span>
<span class="k">class</span> <span class="nc">TraderwarSpider</span><span class="p">(</span><span class="n">scrapy</span><span class="o">.</span><span class="n">Spider</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"TraderWar"</span>
    <span class="n">allowed_domains</span> <span class="o">=</span> <span class="p">[</span><span class="s">"search.sina.com.cn"</span><span class="p">]</span>
    <span class="n">start_urls</span> <span class="o">=</span> <span class="p">[</span><span class="s">'http://search.sina.com.cn/'</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
        <span class="k">pass</span>
</code></pre></div></div>

<h4 id="1-ç¡®å®šstart_urls">1. ç¡®å®š<code class="highlighter-rouge">start_urls</code></h4>
<p>åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€search.sina.com.cnï¼Œè¾“å…¥æœç´¢è¯ï¼Œå¦‚â€œä¸­ç¾è´¸æ˜“æˆ˜â€ï¼Œç‚¹å‡»æœç´¢ç»“æœçš„ç¬¬2é¡µï¼Œå¾—åˆ°ç½‘å€
http://search.sina.com.cn/?q=%D6%D0%C3%C0%C3%B3%D2%D7%D5%BD&amp;c=news&amp;from=index&amp;col=&amp;range=&amp;source=&amp;country=&amp;size=&amp;time=&amp;a=&amp;page=2&amp;pf=0&amp;ps=0&amp;dpc=1
å°†page=2ä¸­çš„2æ›¿æ¢æˆä»»ä¸€æ•°å­—ï¼Œåˆ™å¾—åˆ°äº†æ¯ä¸€é¡µæœç´¢çš„ç½‘å€</p>

<h4 id="2-æå–æ¯æ¡æ–°é—»æ ‡é¢˜èƒŒåçš„é“¾æ¥">2. æå–æ¯æ¡æ–°é—»æ ‡é¢˜èƒŒåçš„é“¾æ¥</h4>
<p>æ¯ä¸€ä¸ªæœç´¢é¡µé¢çš„ç½‘å€å°†è¢«ä¼ å…¥åˆ°<code class="highlighter-rouge">parse</code>å‡½æ•°ï¼Œåœ¨æµè§ˆå™¨â€œæ£€æŸ¥â€ä¸­æŸ¥çœ‹ç½‘é¡µæºä»£ç ï¼Œæ‰¾åˆ°æ¯æ¡æ–°é—»çš„æ ‡é¢˜é“¾æ¥çš„xpathè·¯å¾„ï¼Œåˆ™å¯æå–é“¾æ¥</p>
<h4 id="3-æŒ‡å®šé¡µé¢å†…å®¹ä¸­çˆ¬å–çš„å…ƒç´ ">3. æŒ‡å®šé¡µé¢å†…å®¹ä¸­çˆ¬å–çš„å…ƒç´ </h4>
<p>æå–çš„æ–°é—»é“¾æ¥ä¼ å…¥<code class="highlighter-rouge">parse_detail</code>å‡½æ•°ï¼Œscrapyå°†è‡ªåŠ¨è®¿é—®è¿™äº›é“¾æ¥ï¼ˆå³æ–°é—»è¯¦æƒ…é¡µï¼‰ï¼Œåœ¨æµè§ˆå™¨â€œæ£€æŸ¥â€ä¸­æŸ¥çœ‹ç½‘é¡µæºä»£ç ï¼Œæ‰¾åˆ°æ–°é—»æ ‡é¢˜ã€å‘å¸ƒæ—¶é—´ã€æ¥æºã€å…¨æ–‡å†…å®¹ç­‰çš„xpathè·¯å¾„ï¼Œæå–è¿™äº›å…ƒç´ ä¿å­˜è‡³<code class="highlighter-rouge">NewsspiderItem</code>ï¼Œè¿™æ˜¯ä¸€ä¸ªåœ¨<code class="highlighter-rouge">items.py</code>ä¸­è‡ªå®šä¹‰çš„ç±»ï¼ˆä¸‹æ–‡å°†ä¼šå™è¿°ï¼‰ã€‚</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">scrapy</span>
<span class="kn">from</span> <span class="nn">newsSpider.items</span> <span class="kn">import</span> <span class="n">NewsspiderItem</span>

<span class="k">class</span> <span class="nc">TradewarSpider</span><span class="p">(</span><span class="n">scrapy</span><span class="o">.</span><span class="n">Spider</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"TradeWar"</span>
<span class="c1">#    allowed_domains = ["search.sina.com.cn"]
</span>    <span class="n">start_urls</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s">'http://search.sina.com.cn/?q=</span><span class="si">%</span><span class="s">D6</span><span class="si">%</span><span class="s">D0</span><span class="si">%</span><span class="s">C3</span><span class="si">%</span><span class="s">C0</span><span class="si">%</span><span class="s">C3</span><span class="si">%</span><span class="s">B3</span><span class="si">%</span><span class="s">D2</span><span class="si">%</span><span class="s">D7</span><span class="si">%</span><span class="s">D5</span><span class="si">%</span><span class="s">BD&amp;c=news&amp;from=index&amp;col=&amp;range=&amp;source=&amp;country=&amp;size=&amp;time=&amp;a=&amp;page='</span><span class="o">+</span><span class="s">'</span><span class="si">%</span><span class="s">s&amp;pf=2131425448&amp;ps=2134309112&amp;dpc=1'</span> <span class="o">%</span> <span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span> <span class="c1">#è®¾å®šåªçˆ¬å–å‰20é¡µ
</span>            <span class="p">]</span>

    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">href</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//*[@id="result"]/div/div/h2/a/@href'</span><span class="p">):</span> <span class="c1">#æå–é¡µé¢ä¸­æ¯æ¡æ–°é—»çš„æ ‡é¢˜çš„é“¾æ¥
</span>            <span class="n">full_url</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">urljoin</span><span class="p">(</span><span class="n">href</span><span class="o">.</span><span class="n">extract</span><span class="p">())</span><span class="c1">#è¯¥é“¾æ¥æ˜¯ç›¸å¯¹é“¾æ¥ï¼Œè¦æ”¹æˆå®Œæ•´é“¾æ¥
</span>            <span class="k">yield</span> <span class="n">scrapy</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="n">full_url</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parse_detail</span><span class="p">)</span>
            
    <span class="k">def</span> <span class="nf">parse_detail</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//h1[@class="main-title"]/text()'</span><span class="p">)</span><span class="o">.</span><span class="n">extract</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span> <span class="c1">#æ ‡é¢˜
</span>        <span class="n">news</span> <span class="o">=</span> <span class="n">NewsspiderItem</span><span class="p">()</span>
        <span class="n">news</span><span class="p">[</span><span class="s">"url"</span><span class="p">]</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">url</span>
        <span class="n">news</span><span class="p">[</span><span class="s">"title"</span><span class="p">]</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//h1[@class="main-title"]/text()'</span><span class="p">)</span><span class="o">.</span><span class="n">extract</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">news</span><span class="p">[</span><span class="s">"time"</span><span class="p">]</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//*[@id="top_bar"]/div/div[2]/span/text()'</span><span class="p">)</span><span class="o">.</span><span class="n">extract</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">news</span><span class="p">[</span><span class="s">"origin"</span><span class="p">]</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//*[@id="top_bar"]/div/div[2]/a/text()'</span><span class="p">)</span><span class="o">.</span><span class="n">extract</span><span class="p">()</span>
        <span class="n">news</span><span class="p">[</span><span class="s">"origin_url"</span><span class="p">]</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//*[@id="top_bar"]/div/div[2]/a/@href'</span><span class="p">)</span><span class="o">.</span><span class="n">extract</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">news</span><span class="p">[</span><span class="s">"detail"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//div[@class="article"]/div/p/text()'</span><span class="p">)</span><span class="o">.</span><span class="n">extract</span><span class="p">())</span><span class="o">+</span>\
        <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//div[@class="article"]/p/text()'</span><span class="p">)</span><span class="o">.</span><span class="n">extract</span><span class="p">())</span><span class="o">+</span>\
        <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//div[@class="article"]/div/div/text()'</span><span class="p">))</span>
        <span class="k">yield</span> <span class="n">news</span>
</code></pre></div></div>

<h4 id="4-å…¶ä»–æ–‡ä»¶çš„ä¿®æ”¹">4. å…¶ä»–æ–‡ä»¶çš„ä¿®æ”¹</h4>

<p>åœ¨<code class="highlighter-rouge">items.py</code>è‡ªå®šä¹‰<code class="highlighter-rouge">NewsspiderItem</code>ç±»ï¼Œç”¨äºå­˜æ”¾è¦çˆ¬å–çš„å†…å®¹</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">NewsspiderItem</span><span class="p">(</span><span class="n">scrapy</span><span class="o">.</span><span class="n">Item</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">scrapy</span><span class="o">.</span><span class="n">Field</span><span class="p">()</span>          
    <span class="n">time</span> <span class="o">=</span> <span class="n">scrapy</span><span class="o">.</span><span class="n">Field</span><span class="p">()</span>      
    <span class="n">origin</span> <span class="o">=</span> <span class="n">scrapy</span><span class="o">.</span><span class="n">Field</span><span class="p">()</span>  
    <span class="n">origin_url</span> <span class="o">=</span> <span class="n">scrapy</span><span class="o">.</span><span class="n">Field</span><span class="p">()</span> 
    <span class="n">detail</span> <span class="o">=</span> <span class="n">scrapy</span><span class="o">.</span><span class="n">Field</span><span class="p">()</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">scrapy</span><span class="o">.</span><span class="n">Field</span><span class="p">()</span>
<span class="c1">#    abstract = scrapy.Field()
</span></code></pre></div></div>

<p>åœ¨<code class="highlighter-rouge">pipelines.py</code>ä¸­è‡ªå®šä¹‰<code class="highlighter-rouge">NewsspiderPipeline</code>ï¼Œç”¨äºå¯¹çˆ¬å–å…ƒç´ çš„ç®€å•å¤„ç†ã€‚å¯å®šä¹‰å¤šä¸ªpipelinesï¼Œåœ¨settingä¸­å†³å®šå¯ç”¨å“ªä¸€ä¸ªã€‚</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">NewsspiderPipeline</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">process_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">spider</span><span class="p">):</span>
        <span class="n">item</span><span class="p">[</span><span class="s">"time"</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s">"time"</span><span class="p">][:</span><span class="mi">11</span><span class="p">]</span><span class="c1">#åªéœ€å‰11ä½
</span>        <span class="n">item</span><span class="p">[</span><span class="s">"detail"</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s">"detail"</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="c1">#å»æ‰ç©ºæ ¼
</span>        <span class="k">return</span> <span class="n">item</span>
</code></pre></div></div>

<p>åœ¨<code class="highlighter-rouge">setting.py</code>ä¸­ï¼Œå…³é—­æœºå™¨äººåè®®</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>é€šä¿—æ¥è¯´ï¼Œ robots.txt æ˜¯éµå¾ª Robotåè®® çš„ä¸€ä¸ªæ–‡ä»¶ï¼Œå®ƒä¿å­˜åœ¨ç½‘ç«™çš„æœåŠ¡å™¨ä¸­ï¼Œå®ƒçš„ä½œç”¨æ˜¯ï¼Œå‘Šè¯‰æœç´¢å¼•æ“çˆ¬è™«ï¼Œæœ¬ç½‘ç«™å“ªäº›ç›®å½•ä¸‹çš„ç½‘é¡µ ä¸å¸Œæœ› ä½ è¿›è¡Œçˆ¬å–æ”¶å½•ã€‚åœ¨Scrapyå¯åŠ¨åï¼Œä¼šåœ¨ç¬¬ä¸€æ—¶é—´è®¿é—®ç½‘ç«™çš„ robots.txt æ–‡ä»¶ï¼Œç„¶åå†³å®šè¯¥ç½‘ç«™çš„çˆ¬å–èŒƒå›´ã€‚

å½“ç„¶ï¼Œæˆ‘ä»¬å¹¶ä¸æ˜¯åœ¨åšæœç´¢å¼•æ“ï¼Œè€Œä¸”åœ¨æŸäº›æƒ…å†µä¸‹æˆ‘ä»¬æƒ³è¦è·å–çš„å†…å®¹æ°æ°æ˜¯è¢« robots.txt æ‰€ç¦æ­¢è®¿é—®çš„ã€‚æ‰€ä»¥ï¼ŒæŸäº›æ—¶å€™ï¼Œæˆ‘ä»¬å°±è¦å°†æ­¤é…ç½®é¡¹è®¾ç½®ä¸º False ï¼Œæ— éœ€éµå®ˆRobotåè®®
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Obey robots.txt rules
</span><span class="n">ROBOTSTXT_OBEY</span> <span class="o">=</span> <span class="bp">False</span>
</code></pre></div></div>

<p>é€‰æ‹©ä½¿ç”¨å“ªå‡ ä¸ªpipelinesã€‚ä¸éœ€è¦åˆ™æ³¨é‡Šã€‚</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ITEM_PIPELINES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">'newsSpider.pipelines.NewsspiderPipeline'</span><span class="p">:</span> <span class="mi">300</span><span class="p">,</span>
<span class="c1">#    'newsSpider.pipelines.NewsAbsspiderPipeline': 600,
</span><span class="p">}</span>

</code></pre></div></div>
<h4 id="5-è¿è¡Œtraderwarpy-å¹¶ä¿å­˜çˆ¬è™«ç»“æœ">5. è¿è¡Œ<code class="highlighter-rouge">TraderWar.py</code> å¹¶ä¿å­˜çˆ¬è™«ç»“æœ</h4>

<p>æ‰“å¼€anaconda promptï¼Œcdåˆ°newsSpider/newsSpiderï¼Œè¿è¡Œ<code class="highlighter-rouge">scrapy crawl TradeWar -o data.csv -s FEED_EXPORT_ENCODING=gbk</code></p>

<p>æˆ–è€…ï¼Œcdåˆ°newsSpider/newsSpider/spidersç›®å½•ä¸‹ï¼Œè¿è¡Œ<code class="highlighter-rouge">scrapy runspider TradeWar.py -o data.csv -s FEED_EXPORT_ENCODING=gbk</code>
åŠ ä¸Š<code class="highlighter-rouge">FEED_EXPORT_ENCODING=gbk</code> å¯è§£å†³csvæ–‡ä»¶ä¸­æ–‡ä¹±ç é—®é¢˜ã€‚</p>

<p>çˆ¬å–æ–‡ä»¶å¦‚ä¸‹æ‰€ç¤ºï¼š
<img src="http://localhost:4000/assets/images/post_images/news-crawl-result.png" alt="news-crawl-result" /></p>

<h3 id="åªåœ¨æœç´¢é¡µé¢çˆ¬å–æ–°é—»æ‘˜è¦æ— éœ€å…¨æ–‡å†…å®¹">åªåœ¨æœç´¢é¡µé¢çˆ¬å–æ–°é—»æ‘˜è¦ï¼Œæ— éœ€å…¨æ–‡å†…å®¹</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">scrapy</span>
<span class="kn">from</span> <span class="nn">newsSpider.items</span> <span class="kn">import</span> <span class="n">NewsAbsspiderItem</span>

<span class="k">class</span> <span class="nc">TradewarlistSpider</span><span class="p">(</span><span class="n">scrapy</span><span class="o">.</span><span class="n">Spider</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"TradeWarList"</span>
    <span class="n">allowed_domains</span> <span class="o">=</span> <span class="p">[</span><span class="s">"search.sina.com.cn"</span><span class="p">]</span>
    <span class="n">start_urls</span> <span class="o">=</span> <span class="p">[</span><span class="s">"http://search.sina.com.cn/?q=</span><span class="si">%</span><span class="s">D6</span><span class="si">%</span><span class="s">D0</span><span class="si">%</span><span class="s">C3</span><span class="si">%</span><span class="s">C0</span><span class="si">%</span><span class="s">C3</span><span class="si">%</span><span class="s">B3</span><span class="si">%</span><span class="s">D2</span><span class="si">%</span><span class="s">D7</span><span class="si">%</span><span class="s">D5</span><span class="si">%</span><span class="s">BD&amp;range=all&amp;c=news&amp;sort=rel"</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
        <span class="c1"># è¯·æ±‚ç¬¬ä¸€é¡µ
</span>        <span class="k">yield</span> <span class="n">scrapy</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parse_next</span><span class="p">)</span>

<span class="c1">#         è¯·æ±‚å…¶å®ƒé¡µ
</span>        <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//*[@id="_function_code_page"]/a'</span><span class="p">)[:</span><span class="mi">9</span><span class="p">]:</span>
            <span class="n">link</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">urljoin</span><span class="p">(</span><span class="n">page</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'@href'</span><span class="p">)</span><span class="o">.</span><span class="n">extract</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">print</span><span class="p">(</span><span class="n">link</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">scrapy</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="n">link</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parse_next</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">parse_next</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//*[@id="result"]/div/div'</span><span class="p">):</span>
            <span class="n">news</span> <span class="o">=</span> <span class="n">NewsAbsspiderItem</span><span class="p">()</span>
            <span class="k">print</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'h2/span/text()'</span><span class="p">)</span><span class="o">.</span><span class="n">extract</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">news</span><span class="p">[</span><span class="s">'title'</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'h2/a'</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">"string(.)"</span><span class="p">)</span><span class="o">.</span><span class="n">extract</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">news</span><span class="p">[</span><span class="s">'abstract'</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'p'</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">"string(.)"</span><span class="p">)</span><span class="o">.</span><span class="n">extract</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">news</span><span class="p">[</span><span class="s">'source'</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'h2/span/text()'</span><span class="p">)</span><span class="o">.</span><span class="n">extract</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">news</span><span class="p">[</span><span class="s">'time2'</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'h2/span/text()'</span><span class="p">)</span><span class="o">.</span><span class="n">extract</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">news</span><span class="p">[</span><span class="s">"url"</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'h2/a/@href'</span><span class="p">)</span><span class="o">.</span><span class="n">extract</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">yield</span> <span class="n">news</span>
</code></pre></div></div>
:ET